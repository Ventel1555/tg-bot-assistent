# Tg-bot-assistent

## Инструкция
1) Создать venv
2) ```pip install pyTelegramBotAPI```
3) Заменить ```"YOUR_BOT_TOKEN"``` на реальный токен бота
4) Запустить скрипт

## Цель и значение
Бота ассистент, где две роли пользователей, одни - тех поддержка, другие - клиенты.
Чтобы стать техподдержкой надо ввести спец команду с токеном. Токен ~~захардкожен~~. Есть бд (sqlite). Любое сообщение пользователя происходит приветствие и поиск свободного ассистента. Свободный ассистент тот, у кого флажок свободен или кто был в сети недавнее, или у кого последний диалог завершился раньше. Подбираем ассистента клиенту, и все сообщения пересылаем ему с подписью имени клиента, у клиента можно спросить имя в начале и сохранить. Все сообщения ассистента пересылаем клиенту. Если ассистент наберет команду завершить диалог, он становится свободным а клиенту приходит сообщение что тикет закрыт и ждем его снова. У ассистента есть команда чтобы посмотреть историю общения этого клиента, история отправляется файлом.

## Структура
### Структура базы данных:

- Таблица support_agents для специалистов поддержки
- Таблица clients для клиентов
- Таблица chat_history для истории сообщений


### Основные команды:

```/start``` - начало работы для клиента 
```/register_support <token>``` - регистрация специалиста
```/available``` - переключение статуса доступности
```/end_chat``` - завершение диалога
```/history``` - получение истории диалога
```/stats``` - статистика работы специалиста


### Основной функционал:

- Регистрация специалистов поддержки по токену
- Автоматическое назначение свободного специалиста
- Сохранение всей истории переписки
- Возможность просмотра истории диалога
- Статистика работы специалистов
```python
def find_available_support():
```
Ищет по приоритетам:
- Сначала ищем доступных и недавно онлайн (до 5 минут)
- Затем просто доступных
- В последнюю очередь тех, кто давно завершил диалог

### В планах
- докер
- историю сохранять в файл (?)

__для докера__
SUPPORT_TOKEN
"YOUR_BOT_TOKEN"